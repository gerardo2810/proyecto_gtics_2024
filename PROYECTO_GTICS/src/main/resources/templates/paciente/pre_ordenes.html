<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec = "http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <!--=============== REMIXICONS ===============-->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.2.0/fonts/remixicon.css" rel="stylesheet">
    <!--=============== CSS ===============-->
    <!-- Font Awesome -->
    <script src="https://kit.fontawesome.com/a2dd6045c4.js" crossorigin="anonymous"></script>

    <link rel="icon" type="image/x-icon" th:href="@{/favicon.png}">

    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <link rel="stylesheet" th:href="@{/css/fonts.css}">
    <link rel="stylesheet" th:href="@{/css/topbar.css}">
    <link rel="stylesheet" th:href="@{/css/footer.css}">
    <link rel="stylesheet" th:href="@{/css/scrollbar.css}">
    <link rel="stylesheet" th:href="@{/css/paciente/paciente.css}">
    <link rel="stylesheet" th:href="@{/css/paciente/carousel.css}">
    <link rel="stylesheet" th:href="@{/css/datatables.css}">
    <link rel="stylesheet" th:href="@{/css/boostrap-datatables.css}">
    <link rel="stylesheet" th:href="@{/css/notificaciones.css}">
    <link rel="stylesheet" th:href="@{/css/loader.css}">


    <!--=============== DataTable ===============-->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.1/css/dataTables.bootstrap5.min.css"/>
    <!--  Bootstrap-->
    <link rel="stylesheet" href="https://cdn.datatables.net/2.0.3/css/dataTables.dataTables.min.css"/>
    <!--==========================================-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w==" crossorigin="anonymous" referrerpolicy="no-referrer">
    <link rel="stylesheet" href="https://www.gstatic.com/dialogflow-console/fast/df-messenger/prod/v1/themes/df-messenger-default.css">
    <script src="https://www.gstatic.com/dialogflow-console/fast/df-messenger/prod/v1/df-messenger.js"></script>

    <style>
        @keyframes rotateContinuous {
            0% {
                transform: rotate(0deg);
                box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
            }
            25% {
                transform: rotate(4deg);
                box-shadow: 5px 5px 10px rgba(0, 0, 0, 0.3);
            }
            50% {
                transform: rotate(0deg);
                box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
            }
            75% {
                transform: rotate(-4deg);
                box-shadow: -5px 5px 10px rgba(0, 0, 0, 0.3);
            }
            100% {
                transform: rotate(0deg);
                box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
            }
        }

        .animationButtonContinuous {
            animation: rotateContinuous 1.5s infinite;
            transition: transform 0.3s ease;
            width: 188px; height: 48px; margin-top: 10px; cursor: pointer; background-color: #0d6efd; color:white;
            border:none;border-radius: 6px; font-size: 16px; font-weight: bold;
        }

        [class^="item"]{
            text-decoration: none;
            margin-right: 20px;
            background: transparent;
            box-shadow: none;
            border: none;
            box-sizing: border-box;
            cursor: pointer;
            &:last-child {
                margin-right: 0;
            }
        }

        .item-4 {
            width: 30px;
            height: 30px;
            position: relative;
            border-radius: 50%;
            background-color: #d10e0e;
            opacity: 0.8;
            transition: 0.3s ease-out;
            &:before,
            &:after {
                content: "";
                position: absolute;
                width: 80%;
                height: 2px;
                background-color: white;
                left: 50%;
                top: 50%;
            }
            &:after {
                transform: translate(-50%, -50%) rotate(45deg);
            }
            &:before {
                transform: translate(-50%, -50%) rotate(-45deg);
            }
            &:hover,
            &:focus {
                transform: scale(1.15);
                opacity: 1;
            }
        }


        .popup-box{
            transform: translateY(-100vh) translateX(-50vw) rotate(45deg);
            animation: drop 2s ease-in-out forwards;
        }
        @keyframes drop {
            0% {
                transform: translateY(-100vh) translateX(-50vw) rotate(45deg);
                opacity: 0;
            }
            50% {
                transform: translateY(15vh) translateX(5vw) rotate(2deg);
                opacity: 1;
            }
            65% {
                transform: translateY(-10vh) translateX(-2.5vw) rotate(0deg);
            }
            80% {
                transform: translateY(5vh) translateX(1.25vw);
            }
            100% {
                transform: translateY(0) translateX(0) rotate(0deg);
                opacity: 1;
            }
        }

    </style>
    <style>
        df-messenger {
            z-index: 999;
            position: fixed;
            --df-messenger-font-color: #000;
            --df-messenger-font-family: Google Sans;
            --df-messenger-chat-background: #f3f6fc;
            --df-messenger-message-user-background: #d3e3fd;
            --df-messenger-message-bot-background: #fff;
            bottom: 16px;
            right: 16px;
        }
    </style>

    <title>Pre Ordenes | Bienestar San Miguel</title>

</head>

<body>
<div id="loader-container"  style="display: flex;flex-direction: column;">

    <div style="display: flex; justify-content: center;margin-top: 250px;">
        <img th:src="@{/media/logo_large_2.png}" style="width: 550px; ">
    </div>

    <div id="loader-wrapper"  class="loader-wrapper">

        <div class="loader">
            <div class="roller"></div>
            <div class="roller"></div>
        </div>

        <div id="loader2" class="loader">
            <div class="roller"></div>
            <div class="roller"></div>
        </div>

        <div id="loader3" class="loader">
            <div class="roller"></div>
            <div class="roller"></div>
        </div>
    </div>

</div>

<div id="content-show" class="hidden">
    <df-messenger
            location="us-east1"
            project-id="focal-baton-405905"
            agent-id="67add3f9-fc2b-46b3-81fe-332970bf4670"
            language-code="es"
            max-query-length="-1">
        <df-messenger-chat-bubble
                chat-title="chatbot-gtics">
        </df-messenger-chat-bubble>
    </df-messenger>
    <header class="header-topbar">
        <nav th:replace="~{fragments/navbar.html :: navbar( active = 'Pre Ordenes')}"></nav>
    </header>

    <div th:replace="~{fragments/banner.html :: banner}"></div>

    <br>
    <div style="display: flex; flex-direction: row; justify-content: center">
        <div class="carousel">
            <button class="arrow back-arrow"><svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-left"><path d="m15 18-6-6 6-6"/></svg></button>

            <div class="slide left">
                <div class="overlay"></div>
                <div class="slide-info">
                    <img style="margin-bottom: 10px;width: 260px" th:src="@{/media/logo_large_2.png}"/>
                </div>
                <img class="slide-bg" th:src="@{/img/crs_precios.png}"/>
            </div>


            <div class="slide showcase">
                <div class="overlay"></div>
                <div class="slide-info" style="display: flex;flex-direction: row; column-gap: 30px">
                    <img style="width: 70px" th:src="@{/favicon.png}"/>
                    <a th:href="@{/paciente/new_orden}"><button class="animationButtonContinuous" >Realizar Orden Web</button></a>
                </div>
                <img class="slide-bg" th:src="@{/img/crs_delivery.png}"/>
            </div>


            <div class="slide left">
                <div class="overlay"></div>
                <div class="slide-info">
                    <img style="width: 70px" th:src="@{/favicon.png}" />
                </div>
                <img class="slide-bg" th:src="@{/img/crs_descuento.png}" />
            </div>


            <button class="arrow next-arrow"><svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right"><path d="m9 18 6-6-6-6"/></svg></button>
        </div>
    </div>


    <br>
    <br>
    <br>
    <div class="container" style="max-width: 1340px">

        <div style="margin-bottom: 50px"></div>
        <h2><i class="fa-solid fa-star" style="color: #8de7ef;"></i><strong style="padding-left: 10px">Pre Ordenes:</strong></h2>
        <div style="margin-bottom: 20px"></div>
        <hr style="border-top: 1px solid #DFDFDF;">
        <div style="margin-bottom: 40px"></div>

        <div style="padding-right: 0; padding-left: 0"> </div>
    </div>




    <div class="container" style="max-width: 1340px">

        <div class="column-start" style="padding-bottom: 1px">

            <div style="display: flex;flex-direction: row;column-gap: 8px">

                <div style="display: flex; flex-direction: column; justify-content: center">

                    <label style="color:dimgray;font-weight: bold; margin-left: 2px; margin-bottom:4px">Filtrar por Estado:</label>

                </div>

                <div style="display: flex; flex-direction: column; justify-content: start">



                    <select class="select-p" id="filtroEstado">
                        <option value="">Mostrar Todos</option>
                        <option value="RECIBIDO">Recibido</option>
                        <option value="EN PROCESO">En proceso</option>
                        <option value="EMPAQUETANDO">Empaquetando</option>
                        <option value="EN RUTA">En ruta</option>
                        <option value="ENTREGADO">Entregado</option>
                    </select>


                </div>
            </div>


            <div style="display: flex; flex-direction: column; justify-content: start">

                <input id="searchInput" class="input-form" style="margin-top: 4px;width: 300px;height: 40px" placeholder="Buscar">

            </div>




        </div>
        <br>

        <table id="miTabla" class="table table-striped">
            <thead>
            <tr style="background-color: #378fff">
                <th style="text-align: center; color: #ffffff; font-weight: normal !important;">Número de Tracking</th>
                <th style="text-align: center; color: #ffffff; font-weight: normal !important;">Fecha de registro</th>
                <th style="text-align: center; color: #ffffff; font-weight: normal !important;">Estado</th>
                <th style="text-align: center; color: #ffffff; font-weight: normal !important;">Acciones</th>
            </tr>
            </thead>
            <tbody>


            <tr th:each="orden : ${lista}">
                <td th:text="${orden.getTracking()}"></td>
                <td style="text-align: center" th:text="${#temporals.format(orden.getFechaIni(), 'dd/MM/yyyy   -   HH:mm')}"></td>
                <td th:switch="${orden.getEstadoOrden()}">
                    <button class="animationButton22" th:case="2">PAGO DISPONIBLE</button>
                    <button class="btn-rcb"           th:case="3">RECIBIDO</button>
                    <button class="btn-pro"           th:case="4">EN PROCESO</button>
                    <button class="btn-empa"          th:case="5">EMPAQUETANDO</button>
                    <button class="btn-ruta"          th:case="6">EN RUTA</button>
                    <button class="btn-listo"         th:case="7">ENTREGADO</button>
                </td>
                <td class="action" th:switch="${orden.getEstadoOrden()}">

                    <a th:case="1"  th:href="@{'/paciente/tracking' + '?id=' + ${orden.getIdOrden()} }"><button  class="btn btn-sm btn-info"><i class="fa-regular fa-eye"></i></button></a>
                    <a th:case="2"  th:href="@{'/paciente/confirmar_pago' + '?id=' + ${orden.getIdOrden()} }"><button  class="btn btn-sm btn-info" style="background-color: #3F71EA;border:none"><i class="fa-regular fa-credit-card"></i></button></a>
                    <a th:case="*"  th:href="@{'/paciente/tracking' + '?id=' + ${orden.getIdOrden()} }"><button  class="btn btn-sm btn-info"><i class="fa-regular fa-eye"></i></button></a>


                </td>
            </tr>





            </tbody>
        </table>

    </div>

    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>

    <div class="popup-container" >

        <div id="popup-box" class="popup-box" style="width: 600px;padding: 0;background-color: transparent !important;">

            <div style="background-color:white; padding-top: 6px;display: flex; flex-direction: row; justify-content: end; height: 36px">
                <button style="margin-right: 10px;" id="closePopup"  class="item-4"></button>
            </div>
            <img style="width: 600px" th:src="@{/img/fiestas_patrias.png}">
            <br>



        </div>
    </div>

    <div th:replace="~{fragments/navbar.html :: footer}">
    </div>
</div>



<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js" integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
<script th:src="@{/js/topbar.js}"></script>
<script th:src="@{/js/carousel.js}"></script>
<script th:src="@{/js/loader.js}"></script>


<script>
    $(document).ready(function() {
        var table = $('#miTabla').DataTable({
            "pageLength":5,
            "lengthChange": false,
            "language": {
                "emptyTable": "No hay registros disponibles",
                "zeroRecords": "No se encontraron registros coincidentes",
                "infoEmpty": "Mostrando 0 a 0 de 0 entradas",
                "search" : "Buscar:",
                "paginate": {
                    "first": "Primero",
                    "last": "Último",
                    "next": "Siguiente",
                    "previous": "Anterior"
                },
                "info": "Mostrando de _START_ a _END_ de _TOTAL_ entradas",
            },
            "drawCallback": function(settings) {
                var api = this.api();
                var pages = api.page.info().pages;

                if (pages <= 1) {
                    $('.dataTables_paginate').hide();
                } else {
                    $('.dataTables_paginate').show();
                }
            }

        });

        $('#filtroEstado').on('change', function() {
            var estado = $(this).val();
            table.column(2).search(estado).draw();

        });

        $('#limpiarFiltros').on('click', function() {
            $('#filtroEstado').val('');
            table.search('').columns().search('').draw();
        });
    });


</script>

<!-- DataTable -->
<script type="text/javascript" src="https://cdn.datatables.net/1.13.1/js/dataTables.bootstrap5.min.js"></script>
<!------>
<style>
    div.dataTables_wrapper div.dataTables_filter {
        text-align: right;
        display: none !important;
    }
</style>


<script>
    document.addEventListener('DOMContentLoaded', () => {
        const popupContainer = document.querySelector('.popup-container');
        const popupbox = document.getElementById('popup-box');
        popupContainer.classList.add('active');
        popupbox.style.animationPlayState = 'running';

    });

    const closePopup = document.getElementById('closePopup');

    closePopup.onclick = () => {
        document.querySelector('.popup-container').classList.remove('active');
    };

</script>


<script>
    $(document).ready(function() {
        var table = $('#miTabla').DataTable();

        $('#searchInput').on('input', function() {
            var searchTerm = $(this).val().trim().toLowerCase();
            if (searchTerm === "") {
                table.search("").draw();
                return;
            }
            table.search(searchTerm).draw();
        });
    });

    document.addEventListener("DOMContentLoaded", function() {
        const button = document.getElementById("shakeButton");

        setInterval(() => {
            button.classList.add("shake");
            setTimeout(() => {
                button.classList.remove("shake");
            }, 500);
        }, 1000);
    });

</script>


<script>
    // Obtener todas las celdas de fecha en la tabla
    var fechaCells = document.querySelectorAll("td:nth-child(2) span");

    // Recorrer todas las celdas de fecha
    fechaCells.forEach(function(cell) {
        // Obtener la fecha formateada en el span oculto
        var fechaFormateada = cell.innerText;

        // Parsear la fecha formateada como un objeto Date
        var fecha = new Date(fechaFormateada);

        // Formatear la fecha como 'dd-MM-yyyy'
        var fechaFormateadaDDMMYYYY = ('0' + fecha.getDate()).slice(-2) + '-' + ('0' + (fecha.getMonth() + 1)).slice(-2) + '-' + fecha.getFullYear();

        // Reemplazar el texto en la celda con la fecha formateada como 'dd-MM-yyyy'
        cell.innerText = fechaFormateadaDDMMYYYY;
    });
</script>
</body>

</html>