<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <!--=============== REMIXICONS ===============-->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.2.0/fonts/remixicon.css" rel="stylesheet">
    <!--=============== CSS ===============-->
    <!-- Font Awesome -->

    <script src="https://kit.fontawesome.com/a2dd6045c4.js" crossorigin="anonymous"></script>


    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <link rel="stylesheet" th:href="@{/css/fonts.css}">
    <link rel="stylesheet" th:href="@{/css/topbar.css}">
    <link rel="stylesheet" th:href="@{/css/footer.css}">
    <link rel="stylesheet" th:href="@{/css/scrollbar.css}">
    <link rel="stylesheet" th:href="@{/css/paciente/paciente.css}">
    <link rel="stylesheet" th:href="@{/css/paciente/chat.css}">
    <link rel="stylesheet" th:href="@{/css/datatables.css}">
    <link rel="stylesheet" th:href="@{/css/boostrap-datatables.css}">



    <!--=============== DataTable ===============-->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.1/css/dataTables.bootstrap5.min.css"/>
    <!--  Bootstrap-->
    <link rel="stylesheet" href="https://cdn.datatables.net/2.0.3/css/dataTables.dataTables.min.css"/>
    <!--==========================================-->


    <title>Mensajería | Bienestar San Miguel</title>

    <style>
        body {
            padding-top: 80px;
        }
        .container2 {
            border: 2px solid #dedede;
            background-color: #f1f1f1;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
        }

        /* Darker chat container */
        .darker {
            border-color: #ccc;
            background-color: #ddd;
        }

        /* Clear floats */
        .container2::after {
            content: "";
            clear: both;
            display: table;
        }

        /* Style images */
        .container2 img {
            float: left;
            max-width: 60px;
            width: 100%;
            margin-right: 20px;
            border-radius: 50%;
        }

        /* Style the right image */
        .container2 img.right {
            float: right;
            margin-left: 20px;
            margin-right:0;
        }

        /* Style time text */
        .time-right {
            float: right;
            color: #aaa;
        }

        /* Style time text */
        .time-left {
            float: left;
            color: #999;
        }
        /* Estilos para el input de texto */
        .container2:last-child {
            display: flex;
            justify-content: flex-end;
            margin-top: 20px; /* Espacio entre el último mensaje y el input */
        }

        .container2:last-child input[type="text"] {
            width: 70%; /* Ancho del input */
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin-right: 10px; /* Espacio entre el input y el botón */
            box-sizing: border-box;
        }

        /* Estilos para el botón de enviar */
        .container2:last-child button {
            background-color: #4CAF50; /* Color de fondo */
            color: white; /* Color del texto */
            padding: 10px 20px; /* Espaciado interno */
            border: none; /* Sin borde */
            border-radius: 5px; /* Borde redondeado */
            cursor: pointer; /* Cursor al pasar */
        }

        /* Estilos para el icono del botón */
        .container2:last-child button i {
            margin-right: 5px; /* Espacio entre el icono y el texto */
        }
    </style>
</head>


<header class="header-topbar">
    <nav class="nav-topbar container">


        <div class="nav-data">
            <div>
                <a href="/"><img class="logo" th:src="@{/media/logo_large_2.png}" alt="Logo"></a>
            </div>

            <!--=============== NAV MENU ===============-->

            <div class="nav-menu" id="nav-menu">
                <ul class="nav-list">
                    <li><a href="/paciente" class="menu-item roboto-regular">Pre Ordenes</a></li>

                    <li><a href="/paciente/ordenes" class="menu-item roboto-regular">Ordenes Web</a></li>

                    <li><a href="/paciente/mensajeria" class="menu-item roboto-regular active">Mensajeria</a></li>


                    <!--=============== DROPDOWN ===============-->
                    <li class="dropdown-item">
                        <div class="menu-item roboto-regular">
                            Perfil <i class="ri-arrow-down-s-line dropdown-arrow"></i>
                        </div>

                        <ul class="dropdown-menu">
                            <div class="inside-dropdown">
                                <li>
                                    <a href="#" class="dropdown-link">
                                        <i class="ri-user-line menu-item dropdown-item roboto-regular"></i> Cambiar contraseña
                                    </a>
                                </li>

                                <li>
                                    <a href="#" class="dropdown-link">
                                        <i class="ri-lock-line menu-item dropdown-item roboto-regular"></i> Cerrar sesión
                                    </a>
                                </li>
                            </div>
                        </ul>
                    </li>

                </ul>
            </div>

            <div class="nav-toggle" id="nav-toggle">
                <i class="ri-menu-line nav-burger" id="menu-icon"></i>
                <i class="ri-close-line nav-close"></i>

                <div class="menu-small" id="menu-small">
                    <div class="inside-menu-small">
                        <div class="nav-menu-small" id="nav-menu-small">
                            <ul class="nav-list-small">
                                <li><a href="/paciente" class="menu-item roboto-regular">Pre Ordenes</a></li>

                                <li><a href="/paciente/ordenes" class="menu-item roboto-regular">Ordenes Web</a></li>

                                <li><a href="/paciente/mensajeria" class="menu-item roboto-regular">Mensajeria</a></li>
                            </ul>

                            <ul class="nav-list-small-perfil">
                                <li><a href="/farmacista/ordenes_web" class="menu-item-small roboto-regular"><i class="ri-user-line roboto-regular"></i>Cambiar contraseña</a></li>

                                <li><a href="/farmacista/pre_ordenes" class="menu-item-small roboto-regular"><i class="ri-lock-line roboto-regular"></i>Cerrar sesión</a></li>
                            </ul>
                        </div>
                    </div>

                </div>

            </div>
        </div>

    </nav>
</header>



<body>



<div class="container">

    <div style="margin-bottom: 50px"></div>
    <h2><i class="fa-solid fa-star" style="color: #8de7ef;"></i><strong style="padding-left: 10px">Orden XYZWXZ</strong></h2>
    <div style="margin-bottom: 20px"></div>
    <hr style="border-top: 1px solid #DFDFDF;">
    <div style="margin-bottom: 40px"></div>

    <div style="padding-right: 0; padding-left: 0"> </div>
    <div style="padding-top:1px; display:flex; justify-content: end " >
        <a class="btn-p" href="/paciente/mensajeria">Regresar a la lista de chats</a>

    </div>
</div>


<br>

<div class="container" style="display: flex; flex-direction: row; column-gap: 10px">


    <!--

    <div class="container">

        <div>

            <div id="messageArea" style="width: 300px; height: 300px; border:4px solid red"></div>

            <div>
                <label>Nombre de usuario:</label>
                <input type="text" id="username" placeholder="Introduce tu nombre">
            </div>
            <br>
            <div>
                <label>Mensaje:</label>
                <input type="text" id="messageInput" placeholder="Introduce tu mensaje">
            </div>
            <br>
            <div>
                <button onclick="sendMessage()">Enviar</button>
            </div>

        </div>

    </div>

    -->



    <div class="container">


        <p id="usersCount" style="padding-bottom: 12px; font-family: 'Montserrat', sans-serif; font-weight: bold;font-size: 14px"></p>

        <section class="Chat">
            <div class="ChatHead">
                <li class="group">
                    <div class="avatar"><img src="/img/farmaceutico.png"></div>
                    <p class="GroupName">Farmacista Coronado Maxwell</p>

                </li>
                <div class="callGroup">
                    <i class="fa-solid fa-phone"></i>
                    <i class="fa-solid fa-video"></i>

                </div>
            </div>
            <div class="MessageContainer">

                <div class="messageSeperator">Today</div>

                <div class="message me">
                    <p class="messageContent">Send Me the Pics!</p>
                    <div class="messageDetails">
                        <div class="messageTime">3:21 PM</div>
                        <i class="fa-solid fa-check"></i>
                    </div>
                </div>

                <div class="message you">
                    <p class="messageContent">Sorry for the Delay!</p>
                    <div class="messageDetails">
                        <div class="messageTime">8:09 AM</div>
                        <i class="fa-solid fa-check"></i>
                    </div>
                </div>




                <div id="messageArea">


                </div>


            </div>

            <div style="display: flex; flex-direction: row; column-gap: 10px; padding: 15px">

                <input type="text" id="messageInput" class="inputMensaje" style="width: 300px" placeholder="Ingrese su mensaje">
                <button onclick="sendMessage()" class="enviar-msg"><i class="fa-solid fa-paper-plane"></i></button>

            </div>





        </section>




    </div>

    <div class="container" style="display: flex; flex-direction: column">
        <div class="container">
            <table id="miTabla2" class="table table-striped">
                <h2>Contenido de la orden</h2>
                <thead>
                <tr style="background-color: #378fff">
                    <th style="text-align: center; color: #ffffff; font-weight: normal !important;">Medicamento</th>
                    <th style="text-align: center; color: #ffffff; font-weight: normal !important;">Imagen</th>
                    <th style="text-align: center; color: #ffffff; font-weight: normal !important;">Cantidad</th>
                    <th style="text-align: center; color: #ffffff; font-weight: normal !important;">Precio unitario</th>
                    <th style="text-align: center; color: #ffffff; font-weight: normal !important;">Precio total</th>
                </tr>
                </thead>


                <tbody>
                <tr>
                    <td>Paracetamol 100 mg</td>
                    <td><img id="imagen" class="medicamento" src="/img/paracetamol.jpg" style="width: 75px ; height: 75px"></td>
                    <td>5</td>
                    <td>S/. 6</td>
                    <td>S/. 30</td>
                </tr>
                <tr>
                    <td>Neurobion 100 mg</td>
                    <td><img class="medicamento" src="/img/neurobion.jpg" style="width: 75px ; height: 75px"></td>
                    <td>5</td>
                    <td>S/. 6</td>
                    <td>S/. 30</td>
                </tr>
                <tr>
                    <td>Nastzol 100 mg</td>
                    <td><img class="medicamento" src="/img/nastzol.jpg" style="width: 75px ; height: 75px"></td>
                    <td>5</td>
                    <td>S/. 6</td>
                    <td>S/. 30</td>
                </tr>
                <tr>
                    <td>Panadol 100 mg</td>
                    <td><img class="medicamento"  src="/img/panadol.jpg" style="width: 75px ; height: 75px"></td>
                    <td>5</td>
                    <td>S/. 6</td>
                    <td>S/. 30</td>
                </tr>
                <tr>
                    <td>Apronax 100 mg</td>
                    <td><img class="medicamento"  src="/img/apronax.jpg" style="width: 75px ; height: 75px"></td>
                    <td>5</td>
                    <td>S/. 6</td>
                    <td>S/. 30</td>
                </tr>
                <tr>
                    <td>Doloral 100 mg</td>
                    <td><img class="medicamento"  src="/img/doloral.jpg" style="width: 75px ; height: 75px"></td>
                    <td>5</td>
                    <td>S/. 6</td>
                    <td>S/. 30</td>
                </tr>


                </tbody>
            </table>
        </div>
        <br>
        <br>

        <div class="container">
            <table id="miTabla3" class="table table-striped">
                <h2>Medicamentos sin Stock</h2>
                <thead>
                <tr style="background-color: #378fff">
                    <th style="text-align: center; color: #ffffff; font-weight: normal !important;">Medicamento</th>
                    <th style="text-align: center; color: #ffffff; font-weight: normal !important;">Imagen</th>
                    <th style="text-align: center; color: #ffffff; font-weight: normal !important;">Cantidad</th>
                    <th style="text-align: center; color: #ffffff; font-weight: normal !important;">Precio unitario</th>
                    <th style="text-align: center; color: #ffffff; font-weight: normal !important;">Precio total</th>
                </tr>
                </thead>


                <tbody>
                <tr>
                    <td>Paracetamol 100 mg</td>
                    <td><img id="imagen" class="medicamento" src="/img/paracetamol.jpg" style="width: 75px ; height: 75px"></td>
                    <td>5</td>
                    <td>S/. 6</td>
                    <td>S/. 30</td>
                </tr>
                <tr>
                    <td>Neurobion 100 mg</td>
                    <td><img class="medicamento" src="/img/neurobion.jpg" style="width: 75px ; height: 75px"></td>
                    <td>5</td>
                    <td>S/. 6</td>
                    <td>S/. 30</td>
                </tr>





                </tbody>
            </table>
            <br>
            <br>
            <br>
            <a class="btn-p" href="/paciente">Generar Pre Orden</a>
            <a class="btn-p" href="/paciente/reemplazar_medicamentos">Reemplazar medicamento</a>
        </div>

    </div>


</div>


<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>



<div >
    <footer id="sticky-footer" class="footer-distributed">
        <div class="footer-left">
            <img class="logo" th:src="@{/media/logo_large_2.png}" alt="Logo" style="width: 400px; height: auto;">
            <p class="footer-links">
                <a href="">Usuarios</a> |
                <a href="">Actividades</a> |
                <a href="">Estadisticas</a> |
                <a href="">Donaciones</a> |
                <a href="">Perfil</a>
            </p>
            <p class="footer-company-name">Copyright © 2023 <strong>Pontificia Universidad Catolica del Perú</strong> Todos los derechos reservados</p>
        </div>

        <div class="footer-center">
            <div>
                <i class="fa fa-map-marker"></i>
                <p><span>Av. Universitaria 1801, San Miguel, 15088</span> Lima, Perú</p>
            </div>

            <div>
                <i class="fa fa-phone"></i>
                <p>+51 982 876 098</p>
            </div>

            <div>
                <i class="fa fa-envelope"></i>
                <p><a href="mailto:sagar00001.co@gmail.com">Lorem ipsum dolor sit amet.</a></p>
            </div>
        </div>

        <div class="footer-right">
            <p class="footer-company-about">
                <span>Lorem, ipsum dolor.</span>
                La carrera de <strong>Ingeniería de las telecomunicaciones</strong> de la <strong>Pontificia Universidad Catolica del Perú</strong> diseñó una pagina WEB.
            </p>
            <div class="footer-icons">
                <a href="https://www.facebook.com/profile.php?id=100009473024310&mibextid=LQQJ4d"><i class="fa fa-facebook"></i></a>
                <a href="https://www.instagram.com/leo.leonar071/?igshid=OGQ5ZDc2ODk2ZA%3D%3Ds"><i class="fa fa-instagram"></i></a>
                <a href="https://www.youtube.com/@pucp"><i class="fa fa-youtube"></i></a>
            </div>
        </div>
    </footer>
</div>




<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js" integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
<script th:src="@{/js/topbar.js}"></script>


<script th:inline="javascript">


    const messageInput = document.getElementById("messageInput");
    messageInput.addEventListener("keyup", function(event) {
        if (event.key === "Enter") {
            event.preventDefault();
            sendMessage();
        }
    });



    let socket = new WebSocket("ws://192.168.22.25:8080/chat"); //mi direccion ip local, usar ipconfig o netstat -a para saber cual es, de recomendacion poner la red lan del celular en laptop o pc en configuracion del adaptador


    socket.onmessage = function (event) {

        if (event.data.startsWith("USER_COUNT:")) {
            // Extrae el número de usuarios del mensaje recibido
            userCount = parseInt(event.data.substring("USER_COUNT:".length));

            // Actualiza el contador de usuarios en la interfaz de usuario
            updateUsersCount();

        }else{

            let messageArea = document.getElementById("messageArea");
            var fechaActual = new Date();
            var horaActual = fechaActual.getHours();
            var minutosActuales = fechaActual.getMinutes();

            if (minutosActuales<10){
                var tiempoActual = horaActual + ':0' + minutosActuales;
            }else{
                var tiempoActual = horaActual + ':' + minutosActuales;
            }


            messageArea.innerHTML += ' <div class="message you">\n' +
                '                    <p class="messageContent" >' + event.data +
                '                    </p><div class="messageDetails">\n' +
                '                        <div class="messageTime">' + tiempoActual  +
                '                        </div><i class="fa-solid fa-check"></i>\n' +
                '                    </div>\n' +
                '                </div>'

        }



    }

    function sendMessage(){
        //let username = document.getElementById("username");
        let messageInput = document.getElementById("messageInput");

        if(messageInput.value.trim() != ''){
            //let fullMessage = username.value + ": " + messageInput.value;
            let fullMessage = messageInput.value;
            socket.send(fullMessage);
            messageInput.value = '';
        }

    }


    function updateUsersCount() {
        let usersCountElement = document.getElementById("usersCount");
        if (usersCountElement) {
            usersCountElement.textContent = 'USUARIOS CONECTADOS: ' + userCount;
        }
    }




</script>
<script>
    $(document).ready(function() {
        var table = $('#miTabla2').DataTable({
            "pageLength":3,
            "lengthChange": false,
            "language": {
                "emptyTable": "No hay registros disponibles",
                "zeroRecords": "No se encontraron registros coincidentes",
                "infoEmpty": "Mostrando 0 a 0 de 0 entradas",
                "search" : "Buscar:",
                "paginate": {
                    "first": "Primero",
                    "last": "Último",
                    "next": "Siguiente",
                    "previous": "Anterior"
                },
                "info": "Mostrando de _START_ a _END_ de _TOTAL_ entradas",
            },

        });
        var table = $('#miTabla3').DataTable({
            "pageLength":3,
            "lengthChange": false,
            "language": {
                "emptyTable": "No hay registros disponibles",
                "zeroRecords": "No se encontraron registros coincidentes",
                "infoEmpty": "Mostrando 0 a 0 de 0 entradas",
                "search" : "Buscar:",
                "paginate": {
                    "first": "Primero",
                    "last": "Último",
                    "next": "Siguiente",
                    "previous": "Anterior"
                },
                "info": "Mostrando de _START_ a _END_ de _TOTAL_ entradas",
            },

        });

        $('#filtroEstado').on('change', function() {
            var estado = $(this).val();
            table.column(2).search(estado).draw();

        });

        $('#limpiarFiltros').on('click', function() {
            $('#filtroEstado').val('');
            table.search('').columns().search('').draw();
        });
    });


</script>
<!-- DataTable -->
<script type="text/javascript" src="https://cdn.datatables.net/1.13.1/js/dataTables.bootstrap5.min.js"></script>
<!------>

</body>

</html>