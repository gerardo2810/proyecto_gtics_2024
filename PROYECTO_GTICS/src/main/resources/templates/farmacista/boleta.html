<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec = "http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <link rel="icon" type="image/x-icon" th:href="@{/favicon.png}">

    <!--=============== REMIXICONS ===============-->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.2.0/fonts/remixicon.css" rel="stylesheet">
    <!-- Font Awesome -->
    <script src="https://kit.fontawesome.com/a2dd6045c4.js" crossorigin="anonymous"></script>

    <!--=============== CSS ===============-->
    <link th:href="@{/css/styles.css}" rel="stylesheet" />
    <link th:href="@{/css/fonts.css}" rel="stylesheet" />
    <link rel="stylesheet" th:href="@{/css/farmacista/farmacista.css}">
    <link rel="stylesheet" th:href="@{/css/farmacista/detalle_ordenes.css}">
    <link th:href="@{/css/footer.css}" rel="stylesheet" />
    <link rel="stylesheet" th:href="@{/css/paciente/progress-bar.css}">

    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <link rel="stylesheet" th:href="@{/css/fonts.css}">
    <link rel="stylesheet" th:href="@{/css/topbar.css}">
    <link rel="stylesheet" th:href="@{/css/scrollbar.css}">
    <link rel="stylesheet" th:href="@{/css/perfil.css}">


    <!--Mapa vista Paciente-->
    <script scr="/js/map.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAce4klBZuD60aEQidMVIbsoaiitxxQFpo"></script>

    <!--=============== HTML 2 PDF ===============-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.js"></script>

    <!--=============== JQUERY ===============-->
    <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>

    <!--=============== SWEETALERT ===============-->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.10.7/dist/sweetalert2.all.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11.10.7/dist/sweetalert2.min.css" rel="stylesheet">

    <!--=============== FONT AWESOME ===============-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css"  integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w==" crossorigin="anonymous" referrerpolicy="no-referrer"/>
    <script src="https://kit.fontawesome.com/a2dd6045c4.js" crossorigin="anonymous"></script>


    <title>Bienestar San Miguel | Ordenes Web</title>

    <style>
        .pdf{
            padding: 9px;
            width: 190px;
            border: none;
            border-radius: 6px;
            background-color: #dc3545;
            color:white;
            transition: background-color 0.3s, border-color 0.3s;
            font-size: 12px;
            cursor: pointer;
        }



        .pdf:hover{
            padding: 7px;
            width: 190px;
            border: 2px solid #dc3545;
            border-radius: 6px;
            background-color: white;
            color:#dc3545;
        }

        .print{
            padding: 9px;
            width: 190px;
            border: none;
            border-radius: 6px;
            background-color: #918989;
            color:white;
            transition: background-color 0.3s, border-color 0.3s;
            cursor: pointer;
        }

        .print:hover{
            padding: 7px;
            width: 190px;
            border: 2px solid #918989;
            border-radius: 6px;
            background-color: white;
            color: #918989;
        }

        .return{
            padding: 10px;
            width: 260px;
            border: none;
            border-radius: 6px;
            background-color: dimgray;
            color:white;
            transition: background-color 0.3s, border-color 0.3s;
            cursor: pointer;
            font-size: 15px;
        }

        .return:hover{
            padding: 8px;
            width: 260px;
            border: 2px solid dimgray;
            border-radius: 6px;
            background-color: white;
            color: dimgray;
        }


        .area {
            height: 19vh !important;
        }

        .circles {
            height: 19vh !important;
        }

        .banner-btn {
            color: #fff !important;
            border: solid 1px #fff !important;
            border-radius: 5px !important;
            cursor: pointer !important;
            align-items: center !important;
            display: flex !important;
            background: none !important;
        }

        .bell-btn {
            padding: 14px 14px 14px 14px;
            font-size: 1.1rem !important;
        }

        .user-btn {
            padding: 10px 12px 10px 12px;
            font-size: 1.1rem !important;
        }

        .exit-btn {
            padding: 14px 12px 14px 12px;
            font-size: 1.1rem !important;
        }

    </style>

</head>


<body style="background-color: white;">

<header class="header-topbar">
    <nav th:replace="~{fragments/navbar.html :: navbar( active = '')}"></nav>
</header>


<div th:replace="~{fragments/banner.html :: banner}"></div>

<div class="container" >


    <div style="padding-top: 20px; padding-bottom: 20px">
        <div class="main-title open-sans-bold"> Detalle de Orden de Venta </div>
    </div>

    <hr class="style-one">

    <div style="display: flex; flex-direction: row;margin-top: 20px;justify-content: space-between; column-gap: 10px">

        <div  style="display: flex; flex-direction: row; column-gap: 10px">
            <button id="download" class="pdf">DESCARGAR COMO PDF</button>
            <button onclick="imprimir()" class="print">IMPRIMIR</button>
        </div>

        <div style="display: flex; flex-direction: row; column-gap: 10px">
            <button class="print" onclick="goBack()">REGRESAR</button>
        </div>

        <script>
            function goBack() {
                window.history.back();
            }
        </script>

    </div>

    <div class="detalle-orden-container" id="boleta">

        <div class="invoice-title">

            <div class="title roboto-medium data-label">Bienestar San Miguel | <span th:text="${orden.getSede().getNombre()}">Sede</span></div>

            <div class="title-info">
                <div class="roboto-bold title data-label">Orden #<span th:text="${orden.getIdOrden() + 10000}"></span> </div>

                <div th:switch="${orden.getEstadoOrden()}">
                    <button class="btn-pend montserrat-medium"          th:case="1">PENDIENTE</button>
                    <button class="btn-pend montserrat-medium"          th:case="2">POR PAGAR</button>
                    <button class="btn-rcb montserrat-medium"           th:case="3">RECIBIDO</button>
                    <button class="btn-pro montserrat-medium"           th:case="4">EN PROCESO</button>
                    <button class="btn-empa montserrat-medium"          th:case="5">EMPAQUETANDO</button>
                    <button class="btn-ruta montserrat-medium"          th:case="6">EN RUTA</button>
                    <button class="btn-listo montserrat-medium"         th:case="7">ENTREGADO</button>
                    <button class="btn-pagado montserrat-medium"        th:case="8">PAGADO</button>
                    <button class="btn-anulado montserrat-medium"       th:case="9">ANULADO</button>
                </div>

            </div>
        </div>

        <div class="invoice-contact">

            <div style="display: flex;flex-direction: row; column-gap: 6px">
                <p style="color:black">Dirección: </p>
                <p style="color:#69707A" th:text="${orden.getSede().getDireccion()}">----</p>
            </div>

            <div style="display: flex;flex-direction: row; column-gap: 6px">
                <p style="color:black">Correo: </p>
                <p style="color:#69707A">clinica.bienestar@sanmiguel.pe</p>
            </div>

            <div style="display: flex;flex-direction: row; column-gap: 6px">
                <p style="color:black">Número: </p>
                <p style="color:#69707A">+51 998524112</p>
            </div>
        </div>

        <hr class="my-4" style="margin-bottom: 20px; margin-top: 20px;">

        <div class="client-info">
            <div class="data-label roboto-medium" style="font-size: 20px">Datos del Cliente:</div>


            <div style="display: flex; flex-direction: row; column-gap: 30px;padding-top: 10px">

                <div style="display: flex;flex-direction: row; column-gap: 6px">
                    <p style="color:black">Nombre: </p>
                    <p style="color:#69707A" th:text="${orden.getPaciente().getNombres() + ' ' + orden.getPaciente().getApellidos()}"></p>
                </div>

                <div style="display: flex;flex-direction: row; column-gap: 6px">
                    <p style="color:black">Seguro: </p>
                    <p style="color:#69707A" th:if="${orden.getSeguroUsado() != 'false'}" th:text="${orden.getPaciente().getSeguro()}"></p>
                    <p style="color:#69707A" th:if="${orden.getSeguroUsado() == 'false'}" th:text="${'Ninguno'}"></p>
                </div>

                <div style="display: flex;flex-direction: row; column-gap: 6px">
                    <p style="color:black">DNI: </p>
                    <p style="color:#69707A" th:text="${orden.getPaciente().getDni()}"></p>
                </div>

                <div style="display: flex;flex-direction: row; column-gap: 6px">
                    <p style="color:black">Celular: </p>
                    <p style="color:#69707A" th:text="${orden.getPaciente().getCelular()}"></p>
                </div>

            </div>

        </div>

        <hr class="my-4" style="margin-bottom: 20px; margin-top: 20px;">

        <div class="invoice-info">
            <div class="data-label roboto-medium" style="font-size: 20px">Datos de la Orden:</div>

            <div style="display: flex; flex-direction: row; column-gap: 30px;padding-top: 10px">

                <div style="display: flex;flex-direction: row; column-gap: 6px">
                    <p style="color:black">Tipo: </p>
                    <p style="color:#69707A" th:if="${orden.getTipoOrden() == 1}">Venta en Tienda</p>
                    <p style="color:#69707A" th:if="${orden.getTipoOrden() == 2}">Orden Web </p>
                </div>

                <div style="display: flex;flex-direction: row; column-gap: 6px">
                    <p style="color:black">Número de Orden:</p>
                    <p style="color:#69707A" th:text="${orden.getIdOrden() + 10000}"></p>
                </div>

                <div style="display: flex;flex-direction: row; column-gap: 6px">
                    <p style="color:black">Fecha:</p>
                    <p style="color:#69707A" th:text="${#temporals.format(orden.getFechaIni(), 'dd/MM/yyyy   -   HH:mm')}"></p>
                </div>

                <div style="display: flex;flex-direction: row; column-gap: 6px">
                    <p style="color:black">Sede:</p>
                    <p style="color:#69707A" th:text="${orden.getSede().getNombre()}"></p>
                </div>

                <div style="display: flex;flex-direction: row; column-gap: 6px">
                    <p style="color:black">Atendido por:</p>
                    <p style="color:#69707A" th:text="${session.usuario.getNombres() + ' ' + session.usuario.getApellidos()}"></p>
                </div>


            </div>

        </div>

        <hr class="my-4" style="margin-bottom: 50px; margin-top: 20px;">

        <div class="title roboto-medium data-label" style="padding-bottom: 20px; font-size: 22px" >Lista de Medicamentos Comprados</div>

        <div>
            <table class="order-table">
                <thead style="padding-bottom: 10px">
                <tr>
                    <th class="text-start" style="max-width: 90px;">No.</th>
                    <th class="text-start" style="max-width: 200px;">Artículo</th>
                    <th class="text-center">Precio</th>
                    <th class="text-center">Cantidad</th>
                    <th class="text-end" style="width: 120px;">Total</th>
                </tr>
                </thead>

                <tbody>
                <tr th:each="m, iterIndex : ${contenidoOrden}">
                    <th class="text-start" style="width: 90px;"><span th:text="${iterIndex.index + 1}"></span></th>
                    <td>
                        <div class="name-unit-item">
                            <div class="text-truncate font-size-14 mb-1" th:text="${m.getIdMedicamento().getNombre()}">Panadol</div>
                            <div class="text-muted mb-0" th:text="${m.getIdMedicamento().getUnidad()}">asdasd</div>
                        </div>
                    </td>
                    <td class="text-center" th:text="${'S/. ' + m.getIdMedicamento().getPrecioVenta()}"></td>
                    <td class="text-center" th:text="${m.getCantidad()}">1</td>
                    <td class="text-end" th:text="${'S/. ' + m.getCantidad() * m.getIdMedicamento().getPrecioVenta()}"></td>

                    <script th:inline="javascript">
                        function limitarDigitos(numero) {
                            var numeroStr = numero.toString();
                            // Obtener los primeros 4 dígitos
                            var primerosCuatroDigitos = numeroStr.substring(0, 4);
                            var numeroLimitado = parseFloat(primerosCuatroDigitos);
                            return numeroLimitado;
                        }
                        var precioVenta = [[${m.getIdMedicamento().precioVenta}]];
                        var cantidad = [[${m.getCantidad()}]];
                        var resultado = precioVenta * cantidad;
                        var resultadoLimitado = limitarDigitos(resultado);
                        document.currentScript.parentElement.querySelector(".text-end").textContent = resultadoLimitado;
                    </script>
                </tr>
                </tbody>

            </table>
        </div>

        <div class="full-total">
            <div class="roboto-regular data-label" style="padding-top: 20px">Total</div>
            <div class="title roboto-medium data-label" th:text="${'S/. ' + orden.getPrecioTotal()}"></div>
        </div>


        <hr class="my-4" style="margin-bottom: 50px; margin-top: 20px;">


    </div>

</div>

<div th:replace="~{fragments/navbar.html :: footer}">
</div>


<script>


    function imprimir() {
        var contenido = document.getElementById('boleta').innerHTML;
        var originalBody = document.body.innerHTML;
        document.body.innerHTML = contenido;
        window.print();
        document.body.innerHTML = originalBody;
    }

    window.onload = function () {
        document.getElementById("download").addEventListener("click", () => {
            const invoice = this.document.getElementById("boleta");
            var opt = {
                margin: 0.2,
                filename: 'boleta_orden_web.pdf',
                html2canvas: {
                    scale: 2,
                },
                jsPDF: {
                    unit: 'in',
                    format: [20, 15],
                    orientation: 'landscape',
                }
            };
            html2pdf().from(invoice).set(opt).save();
        });
    }

</script>

<script>
    $(document).ready(function() {
        let opened = false;

        $('#menu-small').hide();

        $('#nav-toggle').click(function (e) {
            e.stopPropagation();
            if (opened) {
                $('#menu-small').hide();
            } else {
                $('#menu-small').show();
            }
            opened = !opened;
        });
    });
</script>

<script>
    // Puntos del mapa

    const locations = [
        { lat: -12.067713, lng: -77.067505 },
        { lat: -12.067739299285414, lng: -77.07048533833166 },
        { lat: -12.067991537715104, lng: -77.07550755645634 },
        { lat : -12.068533248724986, lng: -77.07808532986617},
        { lat: -12.069724275588285, lng: -77.07804924250952}
    ]

    // Inicializar mapa
    function initMap() {
        const map = new google.maps.Map(document.getElementById("map"), {
            zoom: 16,
            center: locations[0],
        });

        // Crear marcador
        const marker = new google.maps.Marker({
            position: locations[0],
            map: map,
            icon: {
                url: "../img/moto_icon.png", // Ruta de la imagen de la moto
                scaledSize: new google.maps.Size(55, 50) // Tamaño personalizado (ancho, alto)
            } // Ruta de la imagen de la moto
        });

        // Mover el marcador a través de los puntos

        let i = 0;
        const interval = setInterval(() => {
            i++;
            if (i >= locations.length) {
                clearInterval(interval); // Detener el intervalo cuando llega a la tercera posición
                return;
            }
            marker.setPosition(locations[i]);
        }, 2000); // Cambia de ubicación cada 3 segundos

    }

</script>

</body>

</html>
